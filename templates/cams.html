<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cams Page</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
  }
  h1 {
    text-align: center;
    margin: 10px 0;
    color: #333;
  }
  #videoGrid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: 8px;
    padding: 8px;
    height: calc(100% - 50px);
    box-sizing: border-box;
  }
  #videoGrid video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 6px;
    background-color: black;
  }
  #backBtn {
    display: block;
    margin: 10px auto;
    padding: 8px 16px;
    font-size: 16px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>Cameras</h1>
<button id="backBtn" onclick="window.location.href='/'">Back to Map</button>
<div id="videoGrid"></div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.0/dist/hls.min.js"></script>
<script>
const grid = document.getElementById('videoGrid');
let cameras = [];
let startIndex = 0;
const videosOnScreen = 8;

// Fetch cameras from Flask API
fetch("/api/cameras")
  .then(res => res.json())
  .then(data => {
    // Filter only cameras with a VideoUrl
    cameras = data.filter(c => c.VideoUrl).map(c => c.VideoUrl);

    if(cameras.length === 0){
      grid.innerHTML = "<p>No cameras available.</p>";
      return;
    }

    showCameras();
    setInterval(showCameras, 10000); // rotate every 5 seconds
  })
  .catch(err => {
    console.error(err);
    grid.innerHTML = "<p>Error fetching cameras.</p>";
  });

// Show current batch of cameras
function showCameras() {
  grid.innerHTML = '';
  for (let i = 0; i < videosOnScreen; i++) {
    if(cameras.length === 0) break;

    const cameraIndex = (startIndex + i) % cameras.length;
    const videoUrl = cameras[cameraIndex];
    const vid = document.createElement('video');
    vid.autoplay = true;
    vid.controls = true;
    vid.muted = true;

    if(Hls.isSupported()){
      const hls = new Hls();
      hls.loadSource(videoUrl);
      hls.attachMedia(vid);
    } else {
      vid.src = videoUrl;
    }

    grid.appendChild(vid);
  }

  startIndex = (startIndex + videosOnScreen) % cameras.length;
}
</script>
</body>
</html>
